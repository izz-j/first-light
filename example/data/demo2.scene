;; -*- mode: common-lisp -*-

(in-package :first-light-example)

(defun random-shots (base extra)
  (+ base (random extra)))

(scene-definition :demo2 (:enabled t)
  ((@lookat-me
    ((transform :translation/incremental (vec 1 0 0)
                :scale/current (vec 10 10 10))
     (mesh)
     (mesh-renderer)))

   (@camera
    ((transform :translation/current (vec 0 0 128))
     (tracking-camera :activep t
                      :mode :orthographic
                      :look-at-actor @lookat-me)))

   (@player-ship
    ((transform :rotation/incremental (vec 0 0 0.07)
                :scale/current (vec 64 64 64))
     (mesh)
     (mesh-renderer)
     (hit-points :hp 100))

    (@thing1
     ((transform :translation/current (vec 1.5 0 0)
                 :scale/current (vec .25 .25 .25))
      (mesh)
      (mesh-renderer)))
    (@thing2
     ((transform :translation/current (vec 0 1.5 0)
                 :scale/current (vec .5 .5 .5))
      (mesh)
      (mesh-renderer)))
    (@thing3
     ((transform :translation/current (vec -1.5 0 0)
                 :scale/current (vec .75 .75 .75))
      (mesh)
      (mesh-renderer)))
    (@thing4
     ((transform :translation/current (vec 0 -1.5 0))
      (mesh)
      (mesh-renderer)))

    (@turret
     ((transform)
      (gun-manager :active-gun 0
                   :guns (vector (actor-component-by-type @laser 'gun)
                                 (actor-component-by-type @missile 'gun))))
     (@laser
      ((transform)
       (gun :shot-count 10
            :shot-type :beam)))
     (@missile
      ((transform)
       (gun :shot-count (random-shots 5 5)
            :shot-type :homing)))))))
